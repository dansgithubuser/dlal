import dlal, atexit

system=dlal.System()

audio=dlal.Component('audio')
fm_midi=dlal.Component('fm')
fm_sfml=dlal.Component('fm')
fm_line=dlal.Component('fm')
midi=dlal.Component('midi')
sfml=dlal.Component('sfml')
buf=dlal.Component('buffer')
mul=dlal.Component('multiplier')
switch=dlal.Component('switch')
com=dlal.Component('commander')
liner1=dlal.Liner()
liner2=dlal.Liner()

audio.command('set 22050 6')
buf.command('resize 64')
mul.command('set 64.0')
print midi.command('ports')
try: midi.command('open KeyRig')
except RuntimeError as e: print e.message
com.command('period 102400')
com.command('queue 0 set 0')
liner1.command('period 102400')
liner1.line('S 3200  O 4  z. .. .... .. z. . d. .  g. .. .... .. g. .  d. .')
liner2.command('period 102400')
liner2.line('S 12800 O 3  w 4 e j w 4 e b')

midi.connect(fm_midi)
sfml.connect(fm_sfml)
liner1.connect(switch)
liner2.connect(switch)
switch.connect(fm_line)
fm_midi.connect(audio)
fm_sfml.connect(audio)
fm_line.connect(audio)
audio.connect(buf)
mul.connect(buf)
buf.connect(audio)
com.connectOutput(switch)

sfml.add(system)
midi.add(system)
liner1.add(system)
liner2.add(system)
mul.add(system)
audio.add(system)
fm_midi.add(system)
fm_sfml.add(system)
fm_line.add(system)
buf.add(system)
switch.add(system)
com.add(system)

audio.command('start')
atexit.register(lambda: audio.command('finish'))
